{
  "hash": "5fa273848181cf2d8513dec9282efd18",
  "result": {
    "markdown": "---\ntitle: \"Hämta data från SCB till R\"\nauthor: \"Filip Wästberg\"\ndate: \"2020-06-08\"\ncategories: [open data, scb]\nimage: preview.png\n---\n\n\nVisste du att du kan hämta data direkt från SCB, Statistiska centralbyrån till R? \n\nDu behöver alltså inte gå in i statistikdatabasen och ta ut en ny Excel-tabell varje gång du ska uppdatera SCB-statistik utan kan istället låta paketet `pxweb` av Måns Magnusson ställa frågor mot SCB:s API och få koden för det. Perfekt om ens verksamhet använder offentlig statistik återkommande.\n\nMed den interaktiva funktionen `pxweb_interactive()` kan vi prata med SCB:s (och flera andra nationella statistikcentraler) API.\n\nJag brukar först använda [statistikdatabsen](https://www.statistikdatabasen.scb.se/pxweb/sv/ssd/) för att hitta det jag söker och sedan navigera mig till det genom `pxweb`, som följer samma struktur som hemsidan. \n\nDu laddar ner paketet med `install.packages(\"pxweb\")`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pxweb)\n\npxweb_interactive()\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n```\npxweb 0.13.1: R tools for the PX-WEB API.\nhttps://github.com/ropengov/pxweb\n```\n:::\n:::\n\n\nNär du klickat dig fram till den statistik du är intresserad av får du koden för att ladda ner data programmatiskt. \n\n\n::: {.cell}\n\n```{.r .cell-code}\npxweb_query_list <-\tlist(\"Kon\"=c(\"1\", \"2\"), \n                         \"ContentsCode\"=c(\"000000MD\",\"000000ME\"),\n                         \"Tid\"=c(\"1968\",\"1969\",\"1970\",\"1971\",\"1972\",\n                                 \"1973\",\"1974\",\"1975\",\"1976\",\"1977\",\"1978\",\n                                 \"1979\",\"1980\",\"1981\",\"1982\",\"1983\",\"1984\",\n                                 \"1985\",\"1986\",\"1987\",\"1988\",\"1989\",\"1990\",\n                                 \"1991\",\"1992\",\"1993\",\"1994\",\"1995\",\"1996\",\n                                 \"1997\",\"1998\",\"1999\",\"2000\",\"2001\",\"2002\",\n                                 \"2003\",\"2004\",\"2005\",\"2006\",\"2007\",\"2008\",\n                                 \"2009\",\"2010\",\"2011\",\"2012\",\"2013\",\"2014\",\n                                 \"2015\",\"2016\",\"2017\",\"2018\",\"2019\"))\n\n# Download data \npx_data <- \n  pxweb_get(url = \"http://api.scb.se/OV0104/v1/doris/sv/ssd/BE/BE0101/BE0101B/BefolkMedianAlder\",\n            query = pxweb_query_list)\n\n# Convert to data.frame \npx_df <- as.data.frame(px_data, column.name.type = \"text\", variable.value.type = \"text\")\n```\n:::\n\n\nNu kan vi visualisera data, exportera den eller göra vad vi nu vill med den.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(glue)\nlibrary(scales)\n\nmin_år <- min(as.numeric(px_df$år))\nmax_år <- max(as.numeric(px_df$år))\n\npx_df %>% \n  mutate(år = as.numeric(år)) %>% \n  ggplot(aes(år, Medianålder, color = kön)) +\n  geom_line() +\n  labs(\n    title = \"Medianålder i Sverige\",\n    subtitle = glue(\"Från {min_år}-{max_år}\"),\n    x = \"\"\n  ) +\n  scale_y_continuous(limits = c(0, 50), labels = number_format(suffix = \" år\")) +\n  scale_x_continuous(breaks = pretty_breaks(10)) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](data-from-scb_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "data-from-scb_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}